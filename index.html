<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>検査申請</title>

<style>
  body {
    font-family: sans-serif;
    max-width: 600px;
    margin: auto;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input, select, textarea, button {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
  }
  button {
    margin-top: 15px;
    font-size: 16px;
  }
</style>
</head>

<body>

<h2>検査申請フォーム</h2>

<label>業者名
  <input type="text" id="vendor" required>
</label>

<label>船番
  <input type="text" id="shipNo" required>
</label>

<label>ブロック
  <input type="text" id="block" required>
</label>

<label>区画
  <select id="area">
    <option value="全量">全量</option>
    <option value="半分">半分</option>
  </select>
</label>

<label>検査日
  <input type="date" id="date">
</label>

<label>時間
  <select id="time">
    <option value="">選択してください</option>
    <option>08:00</option>
    <option>09:00</option>
    <option>10:00</option>
    <option>11:00</option>
    <option>12:00</option>
    <option>13:00</option>
    <option>14:00</option>
    <option>15:00</option>
    <option>16:00</option>
    <option>17:00</option>
  </select>
</label>

<label>検査場所
  <select id="place" onchange="toggleNote()">
    <option value="A棟">A棟</option>
    <option value="B棟">B棟</option>
    <option value="C棟">C棟</option>
    <option value="ブロック置き場">ブロック置き場</option>
    <option value="SUB">SUB</option>
    <option value="その他">その他</option>
  </select>
</label>

<label id="noteArea" style="display:none;">備考（自由記述）
  <textarea id="note"></textarea>
</label>

<button onclick="submitForm()">申請する</button>

<script>
const GAS_URL ="https://script.google.com/macros/s/AKfycbxqdss65l9VQYnwxBMNHeghRCvH5gJncBA6m7jy6Ap7AWm20EPW_0pN94PQNKuQWIH3/exec"

/**
 * 初期表示：検査日が未指定なら翌日
 */
window.onload = () => {
  const d = new Date();
  d.setDate(d.getDate() + 1);
  document.getElementById("date").value = d.toISOString().slice(0,10);
};

function toggleNote() {
  const place = document.getElementById("place").value;
  document.getElementById("noteArea").style.display =
    place === "その他" ? "block" : "none";
}

function submitForm() {
  const data = {
    vendor: vendor.value,
    shipNo: shipNo.value,
    block: block.value,
    area: area.value,
    date: date.value,
    time: time.value,
    place: place.value,
    note: note.value
  };

  fetch(GAS_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(res => res.text())
  .then(text => {
    if (text === "OK") {
      alert("申請完了しました");
      location.reload();
    } else {
      alert("申請失敗：" + text);
    }
  })
  .catch(() => {
    alert("通信エラーが発生しました");
  });
}
</script>

</body>
</html>
